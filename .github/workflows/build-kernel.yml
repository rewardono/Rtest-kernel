- name: Surgical Code Fixes
      run: |
        cd kernel
        # 1. Fix bpf_trace.c (Standard cleanup)
        sed -i 's/static inline __printf(1, 0) int bpf_do_trace_printk/static __printf(1, 0) int bpf_do_trace_printk/g' kernel/trace/bpf_trace.c
        
        # 2. Fix lb_cfs_tasks (SAMSUNG EMS SPECIAL)
        # We modify the actual EMS header signature so it matches the fair.c expectations
        sed -i 's/int sse/struct sched_entity *se/g' include/linux/ems.h

        # 3. Fix Memory Boosting (SAMSUNG VMSCAN SPECIAL)
        # We delete the entire function block inside vmscan.c to prevent the 'redefinition' error
        sed -i '/inline bool need_memory_boosting(void)/,/}/d' mm/vmscan.c
        # Then we provide the one safe global version in the header
        sed -i 's/extern inline bool need_memory_boosting(void);/static inline bool need_memory_boosting(void) { return false; }/g' include/linux/mm.h

        # 4. Global Warning Suppression (The "Nuclear" Option)
        # This prevents any minor Samsung code style issues from being treated as fatal errors
        find . -type f -name "Makefile*" -exec sed -i 's/-Werror-/-W/g' {} +
        find . -type f -name "Makefile*" -exec sed -i 's/-Werror=/-W/g' {} +
        find . -type f -name "Makefile*" -exec sed -i 's/-Werror\b//g' {} +

        # 5. Samsung SecDebug Fix
        sed -i 's|#define secdbg_exin_get_unfz(a).*|#define secdbg_exin_get_unfz(a) ("")|' include/linux/sec_debug.h || true
